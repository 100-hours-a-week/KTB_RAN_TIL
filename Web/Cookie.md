
# Cookie (쿠키)


<aside>

서버와 클라이언트 간의 **상태(state)** 를 유지하기 위해
사용자의 브라우저(로컬)에 저장되는 **작은 데이터 조각**

</aside>

HTTP는 기본적으로 **Stateless(비상태 프로토콜)** 이다.
즉, 각 요청은 서로 독립적으로 처리되고 이전 요청의 상태를 기억하지 않는다.

이 문제를 해결하기 위해 “쿠키”를 사용한다.
서버는 쿠키를 통해 클라이언트를 식별하고, **사용자의 이전 상태를 기억할 수 있다.**

---

## 쿠키의 동작 방식

1. **서버가 쿠키 생성**

    * 서버는 응답 헤더(`Set-Cookie`)를 통해 쿠키 데이터를 전송한다.

   ```http
   Set-Cookie: userId=1234; Path=/; Expires=Sat, 26 Oct 2025 12:00:00 GMT
   ```
2. **브라우저가 쿠키 저장**

    * 이 쿠키는 사용자의 로컬 PC에 저장된다.
      예를 들어, Mac에서는 아래 경로에 저장된다.

      ```
      ~/Library/Application Support/Google/Chrome/Default/Cookies
      ```
3. **브라우저가 요청 시 쿠키 자동 첨부**

    * 이후 같은 서버로 요청을 보낼 때, 브라우저가 자동으로 쿠키를 포함한다.

   ```http
   Cookie: userId=1234
   ```
4. **서버가 쿠키를 읽어 사용자 식별**

    * 서버는 이 쿠키값을 이용해 클라이언트를 구분하고, 로그인 상태나 장바구니 등의 정보를 복원한다.



## 쿠키의 특징

쿠키는 서버가 직접 생성하여 브라우저에 저장하고,
브라우저는 요청마다 해당 쿠키를 서버에 자동으로 포함시킨다.

* 쿠키는 **텍스트 파일 형태로 로컬에 저장**된다.
* **로컬 저장소(PC, 브라우저 내부)** 에 저장되며 브라우저마다 별도로 관리된다.
* **웹 브라우저의 요청과 함께 자동 전송**되어,
  서버는 클라이언트의 상태를 추적할 수 있다.



## 쿠키의 종류

> ### 퍼스트 파티 쿠키 (1st Party Cookie)

사용자가 **직접 방문한 사이트**에서 생성된 쿠키다.
즉, 사용자가 방문한 도메인과 쿠키를 생성한 도메인이 동일하다.

* 예: 사용자가 `a.com`에 접속했을 때 `a.com`이 생성한 쿠키
* 해당 도메인 내부에서만 접근 가능
* 로그인 유지, 장바구니 정보 등 일반적인 사용자 상태 저장에 사용된다.

---

> ### 서드 파티 쿠키 (3rd Party Cookie)

**현재 방문 중인 도메인과 다른 도메인**이 생성한 쿠키다.
예를 들어, 광고나 분석 툴이 외부 도메인에서 쿠키를 설정하는 경우가 있다.

* 예: `a.com` 페이지 안에 `ads.google.com` 배너가 있을 때
  → `ads.google.com` 이 쿠키를 생성하면, 이는 서드파티 쿠키다.
* 여러 웹사이트에서 사용자의 행동을 추적하거나 광고 타겟팅에 활용된다.
* 개인정보 보호 정책 강화로 인해, 최근에는 대부분의 브라우저에서 **차단 추세**다.



## 쿠키의 단점

1. **보안 취약성**

    * 쿠키는 브라우저에 저장되므로 탈취 위험이 있다.
      (예: XSS 공격, 세션 하이재킹)
2. **네트워크 부하 증가**

    * 모든 요청에 쿠키가 자동 첨부되므로 트래픽이 늘어난다.
3. **도메인 간 공유 불가**

    * 한 사이트의 쿠키는 다른 도메인에서 접근할 수 없다.

→ 이러한 이유로, 브라우저는 **웹 스토리지(LocalStorage / SessionStorage)** 를 대안으로 제공한다.

---

## 쿠키의 속성 (보안 설정)

쿠키는 단순히 값만 저장하는 것이 아니라, 보안과 범위를 제어할 수 있는 다양한 속성을 가진다.

> ### HttpOnly

자바스크립트를 통해 쿠키에 접근하지 못하도록 막는다.
즉, XSS 공격을 통해 쿠키 정보(특히 세션 ID)가 탈취되는 것을 방지한다.

> ### Secure

쿠키가 오직 **HTTPS 연결을 통해서만 전송되도록 제한**한다.
이로써 암호화되지 않은 HTTP 통신에서의 중간자 공격(MITM)을 방지할 수 있다.

> ### SameSite

쿠키가 **다른 사이트에서 전송되는 요청에 포함되지 않도록 제한**한다.
CSRF(Cross-Site Request Forgery) 공격 방지에 유용하다.

SameSite는 세 가지 옵션을 가진다.

* **Strict:**
  완전히 동일한 도메인에서의 요청만 쿠키 전송
  (가장 강력한 보안 수준)
* **Lax:**
  GET 요청과 같은 안전한 요청에서는 쿠키 전송 허용
  (대부분의 브라우저 기본값)
* **None:**
  모든 요청에 쿠키 전송 허용. 단, 반드시 `Secure` 옵션과 함께 사용해야 함.

---

## 실제 사용 시나리오

1. 사용자가 `myapp.com`에 로그인한다.
2. 서버가 다음과 같은 헤더로 응답한다.

   ```
   Set-Cookie: sessionId=abc123; Path=/; HttpOnly; Secure; SameSite=Lax
   ```
3. 브라우저는 이 쿠키를 로컬에 저장한다.
4. 이후 사용자가 `myapp.com/profile` 페이지를 요청할 때,
   브라우저는 자동으로 다음과 같이 쿠키를 전송한다.

   ```
   Cookie: sessionId=abc123
   ```
5. 서버는 해당 세션 ID를 이용해 사용자를 식별하고, 로그인 상태를 유지한다.

---