## Proxy

<aside>

클라이언트와 서버 사이에서 **요청과 응답을 대신 전달하는 중간 서버(대리자)**

</aside>

**키워드**

- 대리자
- 클라이언트와 서버 사이

### 특징

- 사용 목적에 따라 Foward Proxy, Reverse Proxy로 나뉨
- 클라이언트가 직접 서버에 접근하지 않도록 하여 **서버 보안성을 강화**하여줌.
- 네트워크 요청을 가로채거나 제어할 수 있음. → 트래픽에 유용하다.

보조개념

- 캐싱 : 자주 사용하는 데이터를 임시로 저장 → 인메모리 redis 같은거
- 로드밸런싱 : 여러 서버로 트래픽을 분산시켜서 부하를 완화

### **Foward Proxy**

- 클라이언트를 대신하여 외부 서버에 요청을 보내는 구조
- 클라이언트 측 프록시 서버
    - **클라이언트 프록시 서버 동작 방식**
    - 사용자가 브라우저에서에서 요청을 보냄 → 프록시 서버로 전달
        - 이때 클라이언트에서는 실제 클라이언트 서버의 IP를 숨기고 프록시 서버의 IP 주소로 변경하여 서버로 전달한다. → **IP 익명성 제공**
        - 프록시 서버의 캐시가 저장되어 있을 경우, 데이터를 가져올 필요 없이 캐시에서 직접 데이터를 반환한다 → **캐시 서버 활용**


- 그럼 항상 클라이언트는 프록시 서버가 존재하는가?
 
    - **아님!**

    - 일반적인 인터넷 연결에서는 클라이언트가 직접 서버에 요청을 보낸다.

    - **보안 강화를 위해서 사용되곤함.**


- **캐시가 프록시 서버에 저장되어있는거였음?**

    - 프록시가 존재하다면 캐시를 프록시에 저장할 수 있다.


- **브라우저에 저장되는 캐시와 프록시 서버에 저장되는 캐시의 차이점**

| 구분 | **브라우저 캐시 (Client Cache)** | **프록시 캐시 (Proxy Cache)** |
| --- | --- | --- |
| 📍 **저장 위치** | 사용자의 **로컬 컴퓨터 / 브라우저 내부** | 네트워크 중간의 **프록시 서버** |
| 👤 **누구를 위해 저장?** | **한 사용자** 전용 | **여러 사용자**가 함께 사용 |
| 🔄 **데이터 접근 경로** | 브라우저 → (캐시 확인) → 서버 | 클라이언트 → 프록시 → 서버 |
| 📦 **저장 내용 예시** | HTML, JS, CSS, 이미지 등 최근 방문 페이지 리소스 | 다수 사용자가 자주 요청한 공통 리소스 (예: 기업 내부에서 YouTube 로고) |
| 🧭 **동작 방식** | 요청 전에 **브라우저 캐시 유효성 검사** (ETag, Last-Modified 등) | 서버 대신 요청을 받아 **캐시된 응답을 대신 전달** |
| 🔒 **범위 / 접근성** | 개인 브라우저 안에서만 접근 가능 | 여러 사용자가 공유 가능한 “중간 캐시” |
| 🔁 **갱신 시점** | 브라우저가 서버에 **유효성 검사 요청** 후 갱신 | 서버 응답의 **Cache-Control 헤더** 기준으로 관리 |
| 💡 **대표 예시** | Chrome 개발자도구 → Application → Cache Storage | 회사 내부망 프록시, CDN (Cloudflare, Akamai 등) |
  

- **브라우저 캐시는 어디에 저장되는 것일까요?**

    - 브라우저는 내 pc 인 **로컬**에서 수행되는 것이기 때문에, 브라우저 캐시는 로컬 내 pc 에 저장되는 캐시 입니다.

  > **캐시 데이터 저장**
  >
    - 디스크(SSD/HDD)나 메모리(RAM)에 저장됨
    - **Chrome (Mac 기준)** →

    ```
    /Users/<username>/Library/Caches/Google/Chrome/Default/Cache/
    ```

  > **브라우저 캐시의 종류**
  >
    - **메모리 캐시**
        - 브라우저가 실행 중일 때만 유지, 빠르지만 휘발성
    - **디스크 캐시**
        - 하드디스크에 저장되어 컴퓨터가 종료되어도 사라지지 않는 영속성
### **Reverse Proxy**

- 웹 서버 측에서 요청을 처리하는 프록시 서버


- 클라이언트이 요청을 받아 → 실제 서버로 전달하고 응답을 반환하여 전달하는 구조
    - 실제 서버의 IP 주소를 숨김
    - 클라이언트의 요청을 받아서 실제 서버로 가기 전, 서버에서 로드 밸런서 역할을 하여 여러 서버로 분산 시킨다. → **로드 밸런서 역할**
    - **ssl 인증서 관리 역할**


  도메인은 주소 그자체이고, **해당 주소로 들어오는 트래픽을 받아서 실제 서버로 보내주는 문지기 역할을 한다.**


- Nginx, Apache, Nginx Proxy Manager, Cloudflare 등
     - 사용자는 `https://myapp.com` 으로 접속
     - Nginx가 `myapp.com` 도메인용 SSL 인증서를 가지고 있어 **TLS 암호화 처리**
     - 내부 통신은 일반적으로 `http://localhost:8080` 으로 전달됨

       (내부는 안전하다고 가정하기 때문)

       **→ 도메인 앞단에서 해당 도메인으로 부터 들어오는 요청을 수행한다.**


- **server 동작 구조**

  - **도메인** : 사용자가 접속할 서버 주소 - myapp.com
  - **DNS 역할** 
    - DNS가 IP 주소를 알려줌
    - IP가 가리키는 곳은 **Nginx 리버스 프록시 서버**

  - **리버스 프록시** : myapp에 들어오는 사용자의 트래픽을 어디로 보낼지 중간 다리 역할을 하는 중간 서버
  - **원본 서버 :** 실제 어플리케이션이 돌아가는 곳 (spring, nodejs )

### 실제 사용 예시(사례)

![image.png](attachment:08150653-9bdf-4445-b16e-29e81b04fd83:image.png)