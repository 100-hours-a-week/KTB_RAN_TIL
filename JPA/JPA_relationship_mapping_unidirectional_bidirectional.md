
# JPA ì—°ê´€ê´€ê³„ â€” 1:N(OneToMany), N:1(ManyToOne) ê´€ê³„

---

### ì •ì˜

<aside>

JPAì˜ ì—°ê´€ê´€ê³„ë€,
ì—”í‹°í‹° ê°„ì˜ ê´€ê³„ë¥¼ ì •ì˜í•˜ê³  **ê°ì²´ ê°„ì˜ ì°¸ì¡°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì™¸ë˜í‚¤(FK)** ë¡œ ë§¤í•‘í•˜ëŠ” ê¸°ìˆ ì´ë‹¤.

</aside>

**í‚¤ì›Œë“œ**
`@OneToMany` / `@ManyToOne` / `mappedBy` / `ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸` / `ì™¸ë˜í‚¤(FK)` / `ì°¸ì¡°(Reference)`

---

## íŠ¹ì§•

* **ëŒ€ë¶€ë¶„ N:1(ë‹¤ëŒ€ì¼) ì–‘ë°©í–¥** êµ¬ì¡°ë¥¼ ì‚¬ìš©í•œë‹¤.
* Nìª½(ë‹¤ìˆ˜)ì˜ í…Œì´ë¸”ì´ **ì™¸ë˜ í‚¤(FK)** ë¥¼ ê°€ì§€ê³ ,
  1ìª½(ë‹¨ì¼) í…Œì´ë¸”ì˜ **ê¸°ë³¸ í‚¤(PK)** ë¥¼ ì°¸ì¡°í•˜ëŠ” êµ¬ì¡°.
* ì¦‰, ì—¬ëŸ¬ ì—”í‹°í‹°ê°€ í•˜ë‚˜ì˜ ì—”í‹°í‹°ì™€ ê´€ê³„ë¥¼ ë§ºë„ë¡ í•œë‹¤.
* **Nìª½ ì—”í‹°í‹°ê°€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner)** ìœ¼ë¡œì„œ FK ì»¬ëŸ¼ì„ ë§¤í•‘í•œë‹¤.

> ğŸ’¡ **ì™¸ë˜í‚¤ Post.user_id â†’ User.id**
>
> `@Id` ì–´ë…¸í…Œì´ì…˜ì€ JPAì—ì„œ **PK ì‹ë³„ì**ë¡œ ì‚¬ìš©ë˜ë©°,
> ì—°ê´€ê´€ê³„ ë§¤í•‘ ì‹œ FKëŠ” ìë™ìœ¼ë¡œ ì´ ì‹ë³„ì(PK)ë¥¼ ì°¸ì¡°í•œë‹¤.

---

##  ManyToOne ë‹¨ë°©í–¥


ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥ ë§¤í•‘ì€ Nìª½ ì—”í‹°í‹°ì—ì„œ 1ìª½ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.
ì¦‰, ì½”ë“œ ìì²´ì—ì„œ Nìª½(Post)ì´ 1ìª½(User)ì„ í•„ë“œë¡œ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— post.getUser()ë¡œ ì ‘ê·¼ì€ ê°€ëŠ¥í•˜ì§€ë§Œ,
1ìª½(User)ì—ì„œëŠ” Nìª½(Post)ì— ëŒ€í•œ ì •ë³´ë¥¼ ì•Œ ìˆ˜ ì—†ë‹¤.
```java
@Entity
public class Post {
    @Id @GeneratedValue
    private Long id;
    private String title;

    @ManyToOne
    @JoinColumn(name = "user_id") // Nìª½ì´ FKë¥¼ ê´€ë¦¬ â†’ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸
    private User user;
}

@Entity
public class User {
    @Id @GeneratedValue
    private Long id;
    private String name;
}
```
ì¦‰, Post ì—”í‹°í‹°ê°€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner)ì´ë‹¤.
DB ì…ì¥ì—ì„œëŠ” ì™¸ë˜í‚¤ user_idê°€ post í…Œì´ë¸”ì— ì¡´ì¬í•˜ë©°,
ì´ ê°’ì´ user í…Œì´ë¸”ì˜ PK(id)ë¥¼ ì°¸ì¡°í•œë‹¤.
JPAëŠ” ì´ëŸ° ê´€ê³„ë¥¼ ì—”í‹°í‹° ê°„ ì°¸ì¡°ë¡œ ê´€ë¦¬í•˜ê³ , ì‹¤ì œ SQLë¡œ ë³€í™˜í•  ë•Œ FKë¥¼ í†µí•´ ì¡°ì¸í•œë‹¤.

###  íŠ¹ì§•

* ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥ ë§¤í•‘ì€ **Nìª½ ì—”í‹°í‹° â†’ 1ìª½ ì—”í‹°í‹°**ë¥¼ ì°¸ì¡°í•œë‹¤.
* `Post`ëŠ” `User`ë¥¼ ì•Œê³  ìˆì§€ë§Œ, `User`ëŠ” `Post`ë¥¼ ëª¨ë¥¸ë‹¤.
* DB ê¸°ì¤€ìœ¼ë¡œ ì™¸ë˜í‚¤(`user_id`)ëŠ” `post` í…Œì´ë¸”ì— ì¡´ì¬.
* JPAëŠ” `Post.user` í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ FKë¥¼ ìë™ ê´€ë¦¬í•œë‹¤.

---

## ManyToOne ì–‘ë°©í–¥

* Nìª½(`Post`)ê³¼ 1ìª½(`User`) ì—”í‹°í‹°ê°€ ì„œë¡œë¥¼ ì°¸ì¡°í•œë‹¤.
* **ì™¸ë˜í‚¤ëŠ” ì—¬ì „íˆ Nìª½(Post)** ì— ì¡´ì¬í•œë‹¤. (DBëŠ” ë‹¨ë°©í–¥ êµ¬ì¡° ìœ ì§€)
* ê°ì²´ ëª¨ë¸ì—ì„œëŠ” ì–‘ìª½ ëª¨ë‘ì—ì„œ ìƒëŒ€ë°© ì ‘ê·¼ ê°€ëŠ¥.
* ì–‘ë°©í–¥ì—ì„œëŠ” **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸**ì„ ëª…ì‹œí•´ì•¼ í•œë‹¤.

    * `mappedBy`ë¡œ ë°˜ëŒ€í¸ì´ ì½ê¸° ì „ìš©ì„ì„ í‘œì‹œ.

```java
@Entity
public class Post {
    @Id @GeneratedValue
    private Long id;

    private String title;

    @ManyToOne
    @JoinColumn(name = "user_id") // FK ê´€ë¦¬, ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸
    private User user;
}

@Entity
public class User {
    @Id @GeneratedValue
    private Long id;

    private String name;

    @OneToMany(mappedBy = "user") // ì½ê¸° ì „ìš©, FKëŠ” Postê°€ ê´€ë¦¬
    private List<Post> posts = new ArrayList<>();
}
```
ì´ êµ¬ì¡°ì—ì„œ postëŠ” userë¥¼ ì°¸ì¡°í•˜ê³ , userë„ ìì‹ ì˜ ê²Œì‹œê¸€ ëª©ë¡(posts)ì„ ì•Œ ìˆ˜ ìˆë‹¤.
ê·¸ëŸ¬ë‚˜ DB ì…ì¥ì—ì„œëŠ” FKê°€ post.user_idì— ì¡´ì¬í•˜ë¯€ë¡œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ Postì´ë©°,
Userì˜ posts í•„ë“œëŠ” ë‹¨ìˆœíˆ ì¡°íšŒ(read-only) ì—­í• ë§Œ í•œë‹¤.

---

### ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner)

* **FKë¥¼ ì‹¤ì œë¡œ ê°€ì§€ëŠ” ìª½(Post)** ì´ **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸**ì´ë‹¤.
* **ì£¼ì¸ë§Œ** FKë¥¼ ë“±ë¡Â·ìˆ˜ì • ê°€ëŠ¥.
* ë°˜ëŒ€í¸(`User.posts`)ì€ ì½ê¸° ì „ìš©(view ì—­í• ).

| êµ¬ë¶„       | ì£¼ì¸        | ë¹„ì£¼ì¸(mappedBy) |
| -------- | --------- | ------------- |
| FK ì¡´ì¬ ì—¬ë¶€ | ìˆìŒ        | ì—†ìŒ            |
| DB ë³€ê²½ ê°€ëŠ¥ | ê°€ëŠ¥        | ë¶ˆê°€ëŠ¥           |
| ì—­í•        | ë°ì´í„° ìˆ˜ì •/ì €ì¥ | ì¡°íšŒ ì „ìš©         |

---

## 1:N ë‹¨ë°©í–¥

* **1ìª½ ì—”í‹°í‹°(User)** ê°€ **Nìª½(Post)** ì„ ì°¸ì¡°í•˜ì§€ë§Œ,
  **Post â†’ User** ì°¸ì¡°ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŒ.
* ì½”ë“œìƒì—ì„œëŠ” `@OneToMany`ê°€ User ìª½ì— ìˆìœ¼ë‚˜,
  DBì—ì„œëŠ” ì—¬ì „íˆ **ì™¸ë˜í‚¤(FK)ëŠ” Post í…Œì´ë¸”ì— ì¡´ì¬**í•œë‹¤.



### ğŸ’¡ `@JoinColumn`

* ì–´ë–¤ ì»¬ëŸ¼ì´ ì™¸ë˜í‚¤ë¡œ ì‚¬ìš©ë ì§€ë¥¼ ëª…ì‹œí•œë‹¤.
* `@JoinColumn(name = "user_id")` â†’ post.user_id ìƒì„±
* ìƒëµí•˜ë©´ ì¤‘ê°„ ì¡°ì¸ í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ë²„ë¦¬ê¸° ë•Œë¬¸ì—, ê°œë°œìê°€ ì˜ë„ì¹˜ ì•Šì€ ì»¨ë²¤ì…˜ê³¼ ë³„ê°œì˜ í…Œì´ë¸”ì´ ìƒì¼ìˆ˜ìˆê³ , ë¶ˆí•„ìš”í•˜ë‹¤.

```java
@Entity
public class Post {
    @Id @GeneratedValue
    private Long id;
    private String title;

    @ManyToOne
    @JoinColumn(name = "user_id") // ì™¸ë˜í‚¤ ì´ë¦„ ì§€ì •
    private User user;
}
```

---

**[Post í…Œì´ë¸” ì˜ˆì‹œ]**

| post_id | title  | user_id (FK) |
| ------- | ------ | ------------ |
| 1       | Hello  | 5            |
| 2       | JPA    | 5            |
| 3       | Spring | 7            |

â†’ User(id=5)ê°€ ì—¬ëŸ¬ ê°œì˜ Postë¥¼ ì°¸ì¡°í•˜ê³  ìˆìŒ.
â†’ FK `user_id`ëŠ” Post í…Œì´ë¸”ì— ì¡´ì¬.

---

###  1:N ë‹¨ë°©í–¥ ì˜ˆì‹œ ì½”ë“œ

```java
@Entity
public class User {
    @Id @GeneratedValue
    private Long id;
    private String name;

    @OneToMany
    @JoinColumn(name = "user_id") // post.user_id FK ì„¤ì •
    private List<Post> posts = new ArrayList<>();
}

@Entity
public class Post {
    @Id @GeneratedValue
    private Long id;
    private String title;
}
```

**User í…Œì´ë¸”**

| id | name |
| -- | ---- |
| 1  | ìƒê·    |
| 2  | ë¯¼ìˆ˜   |

**Post í…Œì´ë¸”**

| id | title  | user_id |
| -- | ------ | ------- |
| 10 | JPA ê³µë¶€ | 1       |
| 11 | ìŠ¤í”„ë§ ê³µë¶€ | 1       |
| 12 | DB ê³µë¶€  | 2       |

---

### **OneToMany ë‹¨ë°©í–¥ì€ ì•ˆí‹°íŒ¨í„´**

```java
@Entity
public class User {
    @Id @GeneratedValue
    private Long id;
    private String name;

    @OneToMany
    @JoinColumn(name = "user_id")  // ğŸ”¥ FKëŠ” post í…Œì´ë¸”ì— ìƒì„±
    private List<Post> posts = new ArrayList<>();
}

@Entity
public class Post {
    @Id @GeneratedValue
    private Long id;
    private String title;
}
```

* ì™¸ë˜í‚¤ê°€ post í…Œì´ë¸”ì— ìƒê²¼ëŠ”ë°,
  **Userê°€ FK(Post.user_id)ë¥¼ ê´€ë¦¬í•˜ë ¤ëŠ” êµ¬ì¡°**ì„.
* ì¦‰, **FKì˜ ì‹¤ì œ ì†Œìœ ì(Post)** ì™€ **ì½”ë“œìƒì˜ ì£¼ì²´(User)** ê°€ ë¶ˆì¼ì¹˜í•¨.
* ê²°ê³¼ì ìœ¼ë¡œ `insert + update` ë‘ ë²ˆ ì¿¼ë¦¬ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

> 
> â€œ**ì™¸ë˜í‚¤ë¥¼ ê°€ì§„ ì—”í‹°í‹°ê°€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ë˜ì–´ì•¼ í•œë‹¤.**â€
> ì¦‰, `@ManyToOne`ì„ ì£¼ë¡œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

---


### 1:Nê³¼ N:1ì˜ ì½”ë“œ ì°¨ì´

**ManyToOne ë‹¨ë°©í–¥**

```java
@Entity
public class Post {
    @Id @GeneratedValue
    private Long id;
    private String title;

    @ManyToOne
    @JoinColumn(name = "user_id") // Nìª½ì´ FKë¥¼ ê´€ë¦¬ â†’ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸
    private User user;
}

@Entity
public class User {
    @Id @GeneratedValue
    private Long id;
    private String name;
}
```

**OneToMany ë‹¨ë°©í–¥**

```java
@Entity
public class User {
    @Id @GeneratedValue
    private Long id;
    private String name;

    @OneToMany
    @JoinColumn(name = "user_id") // post.user_id FK ì„¤ì •
    private List<Post> posts = new ArrayList<>();
}

@Entity
public class Post {
    @Id @GeneratedValue
    private Long id;
    private String title;
}
```

---

ë‘ ë°©ì‹ì˜ í•µì‹¬ì ì¸ ì°¨ì´ì ì€ â€œê°ì²´ ì§€í–¥ ì½”ë“œì—ì„œì˜ ì—­í•  ì£¼ì²´â€ì— ìˆë‹¤.

1:N ë‹¨ë°©í–¥ê³¼ N:1 ë‹¨ë°©í–¥ ëª¨ë‘ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ”
ì™¸ë˜í‚¤(FK)ê°€ **Nìª½(Post) í…Œì´ë¸”ì— ìƒì„±**ëœë‹¤ëŠ” ì ì€ ë™ì¼í•˜ë‹¤.

í•˜ì§€ë§Œ, ì½”ë“œ ìƒì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì°¨ì´ê°€ ìˆë‹¤.

* `@ManyToOne`ì€ FKë¥¼ ì‹¤ì œë¡œ ê°€ì§„ **Nìª½ ì—”í‹°í‹°(Post)** ê°€ ì§ì ‘ ê´€ê³„ë¥¼ ê´€ë¦¬í•œë‹¤.
  â†’ **ê°ì²´ êµ¬ì¡°ì™€ DB êµ¬ì¡°ê°€ ì¼ì¹˜**í•œë‹¤.
* `@OneToMany`ëŠ” FKê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” **1ìª½ ì—”í‹°í‹°(User)** ê°€
  ë°˜ëŒ€í¸ í…Œì´ë¸”(Post)ì˜ FKë¥¼ ì œì–´í•˜ë ¤ê³  ì‹œë„í•œë‹¤.
  â†’ **ê°ì²´ êµ¬ì¡°ì™€ DB êµ¬ì¡°ê°€ ë¶ˆì¼ì¹˜**í•œë‹¤.

ì¦‰, ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ **í•­ìƒ FKë¥¼ ì‹¤ì œë¡œ ê°€ì§„ ìª½(Nìª½, Post)** ì´ì–´ì•¼ í•˜ë©°,
ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ JPAê°€ insert í›„ updateë¥¼ í•œ ë²ˆ ë” ì‹¤í–‰í•˜ëŠ” ë¹„íš¨ìœ¨ì ì¸ SQLì„ ë°œìƒì‹œí‚¨ë‹¤.

ë”°ë¼ì„œ **ê°ì²´ ì„¤ê³„ì™€ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ì„œëŠ”**
`@OneToMany` ë‹¨ë°©í–¥ë³´ë‹¤ëŠ” `@ManyToOne` ë‹¨ë°©í–¥ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´
ì˜¬ë°”ë¥´ê³  íš¨ìœ¨ì ì¸ ì„¤ê³„ ë°©ì‹ì´ë‹¤.




### 1:N vs N:1 ë¹„êµí‘œ

| êµ¬ë¶„      | `@OneToMany ë‹¨ë°©í–¥`          | `@ManyToOne ë‹¨ë°©í–¥`        |
| ------- | ------------------------- | ----------------------- |
| ì½”ë“œìƒ ê´€ê³„  | Userê°€ Post ë¦¬ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ê°€ì§     | Postê°€ Userë¥¼ ì§ì ‘ ì°¸ì¡°       |
| DB êµ¬ì¡°   | FKëŠ” Postì— ìˆì§€ë§Œ Userê°€ ê±´ë“œë¦¼ âŒ | FKëŠ” Postì— ìˆê³  Postê°€ ê´€ë¦¬ âœ… |
| ì—°ê´€ê´€ê³„ ì£¼ì¸ | User(ì˜ëª»ëœ ì„¤ê³„)              | Post(ì •ìƒ)                |
| ì¿¼ë¦¬ ìˆ˜    | INSERT + UPDATE (2íšŒ) âŒ    | INSERT (1íšŒ) âœ…           |
| ì„¤ê³„ ì¼ê´€ì„±  | ê°ì²´-DB ë¶ˆì¼ì¹˜ âŒ               | ê°ì²´-DB ì¼ì¹˜ âœ…              |

> â€œë¶€ëª¨(User)ê°€ ìì‹(Post)ì˜ í‚¤ë¥¼ ì–µì§€ë¡œ ê´€ë¦¬í•˜ëŠ” êµ¬ì¡°ëŠ” ìì—°ìŠ¤ëŸ½ì§€ ì•Šë‹¤.â€
> ë”°ë¼ì„œ **ManyToOne ì¤‘ì‹¬ ì„¤ê³„**ê°€ ì •ì„ì´ë‹¤.

---


###  ì •ë¦¬

| êµ¬ë¶„         | ì—­í•        | ìˆ˜ì • ê°€ëŠ¥ ì—¬ë¶€                                  |
| ---------- | -------- | ----------------------------------------- |
| Post.user  | ì—°ê´€ê´€ê³„ ì£¼ì¸  | ê°€ëŠ¥                                        |
| User.posts | ë°˜ëŒ€í¸(ì¡°íšŒìš©) | ë¶ˆê°€ëŠ¥ (`insertable=false, updatable=false`) |

---

## ì‹¤ë¬´ ì„¤ê³„

**ê¸°ë³¸ ì›ì¹™**

* ì™¸ë˜í‚¤(FK)ë¥¼ ê°€ì§„ ì—”í‹°í‹°ê°€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ë˜ì–´ì•¼ í•œë‹¤.
* ì¦‰, ëŒ€ë¶€ë¶„ì˜ ê´€ê³„ëŠ” `@ManyToOne` ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ê³„í•œë‹¤.

**1:N ë‹¨ë°©í–¥ì€ í”¼í•˜ì**

* ì¿¼ë¦¬ 2ë²ˆ, ë¹„ì¼ê´€ì„± êµ¬ì¡°.
* ëŒ€ì‹  N:1 ë‹¨ë°©í–¥ ë˜ëŠ” N:1 ì–‘ë°©í–¥ìœ¼ë¡œ êµ¬ì„±.

**1:N ì¡°íšŒë§Œ í•„ìš”í•˜ë‹¤ë©´?**

* `@OneToMany(insertable=false, updatable=false)` ë¡œ ì½ê¸° ì „ìš© ë·° êµ¬ì„±.

