
### React Query – 캐싱과 메모리(GC) 구조 정리

React Query가 메모리를 어떻게 관리하는지, 그리고 왜 “모든 API에 React Query를 적용해도 되는지”에 대한 정리

---

### 1. React Query는 서버 데이터를 캐싱한다

React Query의 핵심 기능은 **서버 상태(Server State)를 브라우저 메모리에 캐싱하는 것**이다.

캐싱을 한다는 것은:

* 데이터를 즉시 재사용할 수 있고
* 페이지 이동 후 돌아왔을 때 즉시 표시되며
* 불필요한 네트워크 요청이 줄고
* 사용자 경험이 빨라지는 것

을 의미한다.

즉, React Query는 메모리를 적극적으로 활용하는 구조다.

---

### 2. React Query는 메모리를 "많이" 사용하지 않는다

중요한 이유는 두 가지다.

#### (1) 사용하지 않는 캐시는 GC로 자동 정리된다

React Query는 쿼리가 더 이상 사용되지 않으면 내부 타이머(gcTime/cacheTime)에 따라 캐시를 제거한다.

→ 오래된 캐시가 무한히 쌓이지 않는다
→ 브라우저 메모리를 과도하게 점유하지 않는다

이 GC는 React Query가 자체적으로 관리하는 “메모리 정리 메커니즘”이다.

#### (2) staleTime / cacheTime 설정으로 생명 주기를 관리할 수 있다

예:

```tsx
staleTime: 5000, // 5초 동안 stale 아님
gcTime: 300000,   // 5분 동안 사용되지 않으면 GC
```

* staleTime → 데이터가 신선한 시간
* gcTime(cacheTime) → 사용되지 않으면 메모리에서 제거되는 시간

즉, React Query는 캐시를 무한히 쌓아두지 않는다.

---

### 3. 캐싱 데이터는 “필요한 만큼만” 저장된다

React Query는 데이터를 페이지 단위, key 단위로 저장한다.

너의 커뮤니티 앱을 기준으로 저장되는 데이터는 대부분 다음과 같다.

* 게시글 목록 (텍스트)
* 게시글 상세 (텍스트)
* 댓글 (텍스트)
* 좋아요 수, 조회수 (숫자)
* 사용자 정보 (텍스트 기반)

이런 데이터는 용량이 매우 작다.
이미지, 동영상처럼 무거운 데이터가 아니다.

즉, 실제 메모리 사용량은 크지 않으며 캐싱 부담도 거의 없다.

---

### 4. 그렇다면 모든 API를 React Query로 바꿔도 되는가?

#### → **대부분의 경우 YES.**

React Query는 “서버 상태 관리”를 위한 도구이므로,
서버에서 데이터를 가져오거나 변경하는 API는 **React Query가 가장 효율적인 선택**이다.

특히 아래 유형은 React Query와 궁합이 매우 좋다.

* 게시글 목록 / 상세
* 댓글 목록
* 좋아요 데이터
* 프로필 조회
* 무한스크롤 데이터
* 알림 목록 등

이런 API들은 캐싱·refetch·stale 관리가 필요하기 때문이다.

---

### 5. React Query를 “사용하면 안 되는 경우”도 존재한다

React Query는 *서버 데이터 관리 도구*이다.
따라서 “UI 내부 상태”는 React Query로 관리하면 안 된다.

#### React Query를 사용하지 말아야 하는 경우

| 상황                      | 이유                        |
| ----------------------- | ------------------------- |
| 로그인 폼의 email/password 값 | 서버 상태가 아니라 local UI state |
| 모달 열림/닫힘 여부             | 캐싱할 필요 없음                 |
| 입력 중인 텍스트               | 서버와 무관                    |
| 파일 객체(File)             | 메모리 민감 데이터                |
| 스크롤 위치, 토글값 등           | UI 전용 상태                  |

즉,

> **서버에서 가져오는 데이터 → React Query**
> **UI 내부 상태 → useState / useReducer**

이것이 가장 합리적인 기준이다.

---

### 결론

1. **React Query는 서버 데이터를 캐싱하며, 메모리를 지나치게 사용하지 않는다.**
   GC(gctime/cacheTime)를 통해 사용되지 않는 캐시는 자동으로 제거된다.

2. **staleTime / cacheTime 설정으로 캐시의 생명 주기와 메모리 사용 범위를 통제할 수 있다.**

3. **대부분의 서버 API는 React Query로 전환하는 것이 권장된다.**
   특히 텍스트 기반 커뮤니티 앱에서는 최적의 선택이다.

4. **단, UI 내부 상태는 React Query가 아니라 useState/useReducer로 관리해야 한다.**

